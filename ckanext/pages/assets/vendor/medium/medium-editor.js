function MediumEditor(t,e){"use strict";return this.init(t,e)}"object"==typeof module?module.exports=MediumEditor:"function"==typeof define&&define.amd&&define((function(){"use strict";return MediumEditor})),function(t,e){"use strict";function i(t,e){for(var i=e.parentNode;null!==i;){if(i===t)return!0;i=i.parentNode}return!1}function o(){var t,e,i,o=this.options.contentWindow.getSelection();if(o.getRangeAt&&o.rangeCount){for(i=[],t=0,e=o.rangeCount;t<e;t+=1)i.push(o.getRangeAt(t));return i}return null}function n(t){var e,i,o=this.options.contentWindow.getSelection();if(t)for(o.removeAllRanges(),e=0,i=t.length;e<i;e+=1)o.addRange(t[e])}function r(){var t=this.options.ownerDocument.getSelection().anchorNode;return t&&3===t.nodeType?t.parentNode:t}function a(){var t,e,i,o,n="";if(void 0!==this.options.contentWindow.getSelection){if((e=this.options.contentWindow.getSelection()).rangeCount){for(o=this.options.ownerDocument.createElement("div"),t=0,i=e.rangeCount;t<i;t+=1)o.appendChild(e.getRangeAt(t).cloneContents());n=o.innerHTML}}else void 0!==this.options.ownerDocument.selection&&"Text"===this.options.ownerDocument.selection.type&&(n=this.options.ownerDocument.selection.createRange().htmlText);return n}MediumEditor.prototype={defaults:{allowMultiParagraphSelection:!0,anchorInputPlaceholder:"Paste or type a link",anchorPreviewHideDelay:500,buttons:["bold","italic","underline","anchor","header1","header2","quote"],buttonLabels:!1,checkLinkFormat:!1,cleanPastedHTML:!1,delay:0,diffLeft:0,diffTop:-10,disableReturn:!1,disableDoubleReturn:!1,disableToolbar:!1,disableEditing:!1,elementsContainer:!1,contentWindow:t,ownerDocument:e,firstHeader:"h3",forcePlainText:!0,placeholder:"Type your text",secondHeader:"h4",targetBlank:!1,anchorTarget:!1,anchorButton:!1,anchorButtonClass:"btn",extensions:{},activeButtonClass:"medium-editor-button-active",firstButtonClass:"medium-editor-button-first",lastButtonClass:"medium-editor-button-last"},isIE:"Microsoft Internet Explorer"===navigator.appName||"Netscape"===navigator.appName&&null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(navigator.userAgent),init:function(t,i){if(this.options=function(t,e){var i;if(void 0===t)return e;for(i in e)e.hasOwnProperty(i)&&!1===t.hasOwnProperty(i)&&(t[i]=e[i]);return t}(i,this.defaults),this.setElementSelection(t),0!==this.elements.length)return this.parentElements=["p","h1","h2","h3","h4","h5","h6","blockquote","pre"],this.options.elementsContainer||(this.options.elementsContainer=e.body),this.id=this.options.elementsContainer.querySelectorAll(".medium-editor-toolbar").length+1,this.setup()},setup:function(){this.events=[],this.isActive=!0,this.initElements().bindSelect().bindPaste().setPlaceholders().bindWindowActions().passInstance()},on:function(t,e,i,o){t.addEventListener(e,i,o),this.events.push([t,e,i,o])},off:function(t,e,i,o){var n,r=this.events.indexOf([t,e,i,o]);-1!==r&&(n=this.events.splice(r,1))[0].removeEventListener(n[1],n[2],n[3])},removeAllEvents:function(){for(var t=this.events.pop();t;)t[0].removeEventListener(t[1],t[2],t[3]),t=this.events.pop()},initElements:function(){this.updateElementList();var t,e=!1;for(t=0;t<this.elements.length;t+=1)this.options.disableEditing||this.elements[t].getAttribute("data-disable-editing")||this.elements[t].setAttribute("contentEditable",!0),this.elements[t].getAttribute("data-placeholder")||this.elements[t].setAttribute("data-placeholder",this.options.placeholder),this.elements[t].setAttribute("data-medium-element",!0),this.bindParagraphCreation(t).bindReturn(t).bindTab(t),this.options.disableToolbar||this.elements[t].getAttribute("data-disable-toolbar")||(e=!0);return e&&this.initToolbar().bindButtons().bindAnchorForm().bindAnchorPreview(),this},setElementSelection:function(t){this.elementSelection=t,this.updateElementList()},updateElementList:function(){this.elements="string"==typeof this.elementSelection?this.options.ownerDocument.querySelectorAll(this.elementSelection):this.elementSelection,1===this.elements.nodeType&&(this.elements=[this.elements])},serialize:function(){var t,e={};for(t=0;t<this.elements.length;t+=1)e[""!==this.elements[t].id?this.elements[t].id:"element-"+t]={value:this.elements[t].innerHTML.trim()};return e},callExtensions:function(t){if(!(arguments.length<1)){var e,i,o=Array.prototype.slice.call(arguments,1);for(i in this.options.extensions)this.options.extensions.hasOwnProperty(i)&&void 0!==(e=this.options.extensions[i])[t]&&e[t].apply(e,o)}},passInstance:function(){var t,e,i=this;for(e in i.options.extensions)i.options.extensions.hasOwnProperty(e)&&(t=i.options.extensions[e]).parent&&(t.base=i);return i},bindParagraphCreation:function(t){var i=this;return this.on(this.elements[t],"keypress",(function(t){var o=r.call(i);32===t.which&&"a"===o.tagName.toLowerCase()&&e.execCommand("unlink",!1,null)})),this.on(this.elements[t],"keyup",(function(t){var o,n,a=r.call(i);a&&a.getAttribute("data-medium-element")&&0===a.children.length&&!i.options.disableReturn&&!a.getAttribute("data-disable-return")&&e.execCommand("formatBlock",!1,"p"),13===t.which&&(o=(a=r.call(i)).tagName.toLowerCase(),n=i.getSelectionElement(),i.options.disableReturn||n.getAttribute("data-disable-return")||"li"===o||i.isListItemChild(a)||(t.shiftKey||e.execCommand("formatBlock",!1,"p"),"a"===o&&e.execCommand("unlink",!1,null)))})),this},isListItemChild:function(t){for(var e=t.parentNode,i=e.tagName.toLowerCase();-1===this.parentElements.indexOf(i)&&"div"!==i;){if("li"===i)return!0;if(!(e=e.parentNode)||!e.tagName)return!1;i=e.tagName.toLowerCase()}return!1},bindReturn:function(t){var e=this;return this.on(this.elements[t],"keypress",(function(t){if(13===t.which)if(e.options.disableReturn||this.getAttribute("data-disable-return"))t.preventDefault();else if(e.options.disableDoubleReturn||this.getAttribute("data-disable-double-return")){var i=r.call(e);i&&"\n"===i.innerText&&t.preventDefault()}})),this},bindTab:function(t){var i=this;return this.on(this.elements[t],"keydown",(function(t){if(9===t.which){var o=r.call(i).tagName.toLowerCase();"pre"===o&&(t.preventDefault(),e.execCommand("insertHtml",null,"    ")),"li"===o&&(t.preventDefault(),t.shiftKey?e.execCommand("outdent",t):e.execCommand("indent",t))}})),this},buttonTemplate:function(t){var e=this.getButtonLabels(this.options.buttonLabels);return{bold:'<button class="medium-editor-action medium-editor-action-bold" data-action="bold" data-element="b">'+e.bold+"</button>",italic:'<button class="medium-editor-action medium-editor-action-italic" data-action="italic" data-element="i">'+e.italic+"</button>",underline:'<button class="medium-editor-action medium-editor-action-underline" data-action="underline" data-element="u">'+e.underline+"</button>",strikethrough:'<button class="medium-editor-action medium-editor-action-strikethrough" data-action="strikethrough" data-element="strike">'+e.strikethrough+"</button>",superscript:'<button class="medium-editor-action medium-editor-action-superscript" data-action="superscript" data-element="sup">'+e.superscript+"</button>",subscript:'<button class="medium-editor-action medium-editor-action-subscript" data-action="subscript" data-element="sub">'+e.subscript+"</button>",anchor:'<button class="medium-editor-action medium-editor-action-anchor" data-action="anchor" data-element="a">'+e.anchor+"</button>",image:'<button class="medium-editor-action medium-editor-action-image" data-action="image" data-element="img">'+e.image+"</button>",header1:'<button class="medium-editor-action medium-editor-action-header1" data-action="append-'+this.options.firstHeader+'" data-element="'+this.options.firstHeader+'">'+e.header1+"</button>",header2:'<button class="medium-editor-action medium-editor-action-header2" data-action="append-'+this.options.secondHeader+'" data-element="'+this.options.secondHeader+'">'+e.header2+"</button>",quote:'<button class="medium-editor-action medium-editor-action-quote" data-action="append-blockquote" data-element="blockquote">'+e.quote+"</button>",orderedlist:'<button class="medium-editor-action medium-editor-action-orderedlist" data-action="insertorderedlist" data-element="ol">'+e.orderedlist+"</button>",unorderedlist:'<button class="medium-editor-action medium-editor-action-unorderedlist" data-action="insertunorderedlist" data-element="ul">'+e.unorderedlist+"</button>",pre:'<button class="medium-editor-action medium-editor-action-pre" data-action="append-pre" data-element="pre">'+e.pre+"</button>",indent:'<button class="medium-editor-action medium-editor-action-indent" data-action="indent" data-element="ul">'+e.indent+"</button>",outdent:'<button class="medium-editor-action medium-editor-action-outdent" data-action="outdent" data-element="ul">'+e.outdent+"</button>",justifyCenter:'<button class="medium-editor-action medium-editor-action-justifyCenter" data-action="justifyCenter" data-element="">'+e.justifyCenter+"</button>",justifyFull:'<button class="medium-editor-action medium-editor-action-justifyFull" data-action="justifyFull" data-element="">'+e.justifyFull+"</button>",justifyLeft:'<button class="medium-editor-action medium-editor-action-justifyLeft" data-action="justifyLeft" data-element="">'+e.justifyLeft+"</button>",justifyRight:'<button class="medium-editor-action medium-editor-action-justifyRight" data-action="justifyRight" data-element="">'+e.justifyRight+"</button>"}[t]||!1},getButtonLabels:function(t){var e,i,o={bold:"<b>B</b>",italic:"<b><i>I</i></b>",underline:"<b><u>U</u></b>",strikethrough:"<s>A</s>",superscript:"<b>x<sup>1</sup></b>",subscript:"<b>x<sub>1</sub></b>",anchor:"<b>#</b>",image:"<b>image</b>",header1:"<b>H1</b>",header2:"<b>H2</b>",quote:"<b>&ldquo;</b>",orderedlist:"<b>1.</b>",unorderedlist:"<b>&bull;</b>",pre:"<b>0101</b>",indent:"<b>&rarr;</b>",outdent:"<b>&larr;</b>",justifyCenter:"<b>C</b>",justifyFull:"<b>J</b>",justifyLeft:"<b>L</b>",justifyRight:"<b>R</b>"};if("fontawesome"===t?e={bold:'<i class="fa fa-bold"></i>',italic:'<i class="fa fa-italic"></i>',underline:'<i class="fa fa-underline"></i>',strikethrough:'<i class="fa fa-strikethrough"></i>',superscript:'<i class="fa fa-superscript"></i>',subscript:'<i class="fa fa-subscript"></i>',anchor:'<i class="fa fa-link"></i>',image:'<i class="fa fa-picture-o"></i>',quote:'<i class="fa fa-quote-right"></i>',orderedlist:'<i class="fa fa-list-ol"></i>',unorderedlist:'<i class="fa fa-list-ul"></i>',pre:'<i class="fa fa-code fa-lg"></i>',indent:'<i class="fa fa-indent"></i>',outdent:'<i class="fa fa-outdent"></i>',justifyCenter:'<i class="fa fa-align-center"></i>',justifyFull:'<i class="fa fa-align-justify"></i>',justifyLeft:'<i class="fa fa-align-left"></i>',justifyRight:'<i class="fa fa-align-right"></i>'}:"object"==typeof t&&(e=t),"object"==typeof e)for(i in e)e.hasOwnProperty(i)&&(o[i]=e[i]);return o},initToolbar:function(){return this.toolbar||(this.toolbar=this.createToolbar(),this.keepToolbarAlive=!1,this.anchorForm=this.toolbar.querySelector(".medium-editor-toolbar-form-anchor"),this.anchorInput=this.anchorForm.querySelector("input.medium-editor-toolbar-anchor-input"),this.anchorTarget=this.anchorForm.querySelector("input.medium-editor-toolbar-anchor-target"),this.anchorButton=this.anchorForm.querySelector("input.medium-editor-toolbar-anchor-button"),this.toolbarActions=this.toolbar.querySelector(".medium-editor-toolbar-actions"),this.anchorPreview=this.createAnchorPreview()),this},createToolbar:function(){var t=e.createElement("div");return t.id="medium-editor-toolbar-"+this.id,t.className="medium-editor-toolbar",t.appendChild(this.toolbarButtons()),t.appendChild(this.toolbarFormAnchor()),this.options.elementsContainer.appendChild(t),t},toolbarButtons:function(){var t,i,o,n,r,a=this.options.buttons,s=e.createElement("ul");for(s.id="medium-editor-toolbar-actions",s.className="medium-editor-toolbar-actions clearfix",i=0;i<a.length;i+=1)(o=this.options.extensions.hasOwnProperty(a[i])?void 0!==(n=this.options.extensions[a[i]]).getButton?n.getButton():null:this.buttonTemplate(a[i]))&&(t=e.createElement("li"),(r=o)&&1===r.nodeType?t.appendChild(o):t.innerHTML=o,s.appendChild(t));return s},toolbarFormAnchor:function(){var t=e.createElement("div"),i=e.createElement("input"),o=e.createElement("label"),n=e.createElement("input"),r=e.createElement("label"),a=e.createElement("input"),s=e.createElement("a"),l=e.createElement("a");return s.setAttribute("href","#"),s.className="medium-editor-toobar-anchor-close",s.innerHTML="&times;",l.setAttribute("href","#"),l.className="medium-editor-toobar-anchor-save",l.innerHTML="&#10003;",i.setAttribute("type","text"),i.className="medium-editor-toolbar-anchor-input",i.setAttribute("placeholder",this.options.anchorInputPlaceholder),n.setAttribute("type","checkbox"),n.className="medium-editor-toolbar-anchor-target",o.innerHTML="Open in New Window?",o.insertBefore(n,o.firstChild),a.setAttribute("type","checkbox"),a.className="medium-editor-toolbar-anchor-button",r.innerHTML="Button",r.insertBefore(a,r.firstChild),t.className="medium-editor-toolbar-form-anchor",t.id="medium-editor-toolbar-form-anchor",t.appendChild(i),t.appendChild(l),t.appendChild(s),this.options.anchorTarget&&t.appendChild(o),this.options.anchorButton&&t.appendChild(r),t},bindSelect:function(){var t,i=this,o="";for(this.checkSelectionWrapper=function(t){if(t&&i.clickingIntoArchorForm(t))return!1;clearTimeout(o),o=setTimeout((function(){i.checkSelection()}),i.options.delay)},this.on(e.documentElement,"mouseup",this.checkSelectionWrapper),t=0;t<this.elements.length;t+=1)this.on(this.elements[t],"keyup",this.checkSelectionWrapper),this.on(this.elements[t],"blur",this.checkSelectionWrapper);return this},checkSelection:function(){var t,e;return!0===this.keepToolbarAlive||this.options.disableToolbar||(""===(t=this.options.contentWindow.getSelection()).toString().trim()||!1===this.options.allowMultiParagraphSelection&&this.hasMultiParagraphs()||this.selectionInContentEditableFalse()||!(e=this.getSelectionElement())||e.getAttribute("data-disable-toolbar")?this.hideToolbarActions():this.checkSelectionElement(t,e)),this},clickingIntoArchorForm:function(t){return!(!t.type||"blur"!==t.type.toLowerCase()||!t.relatedTarget||t.relatedTarget!==this.anchorInput)},hasMultiParagraphs:function(){var t=a.call(this).replace(/<[\S]+><\/[\S]+>/gim,"").match(/<(p|h[0-6]|blockquote)>([\s\S]*?)<\/(p|h[0-6]|blockquote)>/g);return t?t.length:0},checkSelectionElement:function(t,e){var i;for(this.selection=t,this.selectionRange=this.selection.getRangeAt(0),i=0;i<this.elements.length;i+=1)if(this.elements[i]===e)return void this.setToolbarButtonStates().setToolbarPosition().showToolbarActions();this.hideToolbarActions()},findMatchingSelectionParent:function(t){var e,i=this.options.contentWindow.getSelection();if(0===i.rangeCount)return!1;e=i.getRangeAt(0).commonAncestorContainer;do{if(1===e.nodeType){if(t(e))return e;if(e.getAttribute("data-medium-element"))return!1}e=e.parentNode}while(e);return!1},getSelectionElement:function(){return this.findMatchingSelectionParent((function(t){return t.getAttribute("data-medium-element")}))},selectionInContentEditableFalse:function(){return this.findMatchingSelectionParent((function(t){return t&&"#text"!==t.nodeName&&"false"===t.getAttribute("contenteditable")}))},setToolbarPosition:function(){var t=this.options.contentWindow.getSelection().getRangeAt(0).getBoundingClientRect(),e=this.options.diffLeft-this.toolbar.offsetWidth/2,i=(t.left+t.right)/2,o=this.toolbar.offsetWidth/2;return t.top<50?(this.toolbar.classList.add("medium-toolbar-arrow-over"),this.toolbar.classList.remove("medium-toolbar-arrow-under"),this.toolbar.style.top=50+t.bottom-this.options.diffTop+this.options.contentWindow.pageYOffset-this.toolbar.offsetHeight+"px"):(this.toolbar.classList.add("medium-toolbar-arrow-under"),this.toolbar.classList.remove("medium-toolbar-arrow-over"),this.toolbar.style.top=t.top+this.options.diffTop+this.options.contentWindow.pageYOffset-this.toolbar.offsetHeight+"px"),i<o?this.toolbar.style.left=e+o+"px":this.options.contentWindow.innerWidth-i<o?this.toolbar.style.left=this.options.contentWindow.innerWidth+e-o+"px":this.toolbar.style.left=e+i+"px",this.hideAnchorPreview(),this},setToolbarButtonStates:function(){var t,e=this.toolbarActions.querySelectorAll("button");for(t=0;t<e.length;t+=1)e[t].classList.remove(this.options.activeButtonClass);return this.checkActiveButtons(),this},checkActiveButtons:function(){for(var t=Array.prototype.slice.call(this.elements),e=this.getSelectedParentElement();void 0!==e.tagName&&-1===this.parentElements.indexOf(e.tagName.toLowerCase)&&(this.activateButton(e.tagName.toLowerCase()),this.callExtensions("checkState",e),-1===t.indexOf(e));)e=e.parentNode},activateButton:function(t){var e=this.toolbar.querySelector('[data-element="'+t+'"]');null!==e&&-1===e.className.indexOf(this.options.activeButtonClass)&&(e.className+=" "+this.options.activeButtonClass)},bindButtons:function(){var t,e=this.toolbar.querySelectorAll("button"),i=this,o=function(t){t.preventDefault(),t.stopPropagation(),void 0===i.selection&&i.checkSelection(),this.className.indexOf(i.options.activeButtonClass)>-1?this.classList.remove(i.options.activeButtonClass):this.className+=" "+i.options.activeButtonClass,this.hasAttribute("data-action")&&i.execAction(this.getAttribute("data-action"),t)};for(t=0;t<e.length;t+=1)this.on(e[t],"click",o);return this.setFirstAndLastItems(e),this},setFirstAndLastItems:function(t){return t.length>0&&(t[0].className+=" "+this.options.firstButtonClass,t[t.length-1].className+=" "+this.options.lastButtonClass),this},execAction:function(t,e){t.indexOf("append-")>-1?(this.execFormatBlock(t.replace("append-","")),this.setToolbarPosition(),this.setToolbarButtonStates()):"anchor"===t?this.triggerAnchorAction(e):"image"===t?this.options.ownerDocument.execCommand("insertImage",!1,this.options.contentWindow.getSelection()):(this.options.ownerDocument.execCommand(t,!1,null),this.setToolbarPosition())},rangeSelectsSingleNode:function(t){var e=t.startContainer;return e===t.endContainer&&e.hasChildNodes()&&t.endOffset===t.startOffset+1},getSelectedParentElement:function(){var t=this.selectionRange;return this.rangeSelectsSingleNode(t)?t.startContainer.childNodes[t.startOffset]:3===t.startContainer.nodeType?t.startContainer.parentNode:t.startContainer},triggerAnchorAction:function(){var t=this.getSelectedParentElement();return t.tagName&&"a"===t.tagName.toLowerCase()?this.options.ownerDocument.execCommand("unlink",!1,null):"block"===this.anchorForm.style.display?this.showToolbarActions():this.showAnchorForm(),this},execFormatBlock:function(t){var e=this.getSelectionData(this.selection.anchorNode);if("blockquote"===t&&e.el&&"blockquote"===e.el.parentNode.tagName.toLowerCase())return this.options.ownerDocument.execCommand("outdent",!1,null);if(e.tagName===t&&(t="p"),this.isIE){if("blockquote"===t)return this.options.ownerDocument.execCommand("indent",!1,t);t="<"+t+">"}return this.options.ownerDocument.execCommand("formatBlock",!1,t)},getSelectionData:function(t){var e;for(t&&t.tagName&&(e=t.tagName.toLowerCase());t&&-1===this.parentElements.indexOf(e);)(t=t.parentNode)&&t.tagName&&(e=t.tagName.toLowerCase());return{el:t,tagName:e}},getFirstChild:function(t){for(var e=t.firstChild;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},hideToolbarActions:function(){this.keepToolbarAlive=!1,void 0!==this.toolbar&&this.toolbar.classList.remove("medium-editor-toolbar-active")},showToolbarActions:function(){var t,e=this;this.anchorForm.style.display="none",this.toolbarActions.style.display="block",this.keepToolbarAlive=!1,clearTimeout(t),t=setTimeout((function(){e.toolbar&&!e.toolbar.classList.contains("medium-editor-toolbar-active")&&e.toolbar.classList.add("medium-editor-toolbar-active")}),100)},saveSelection:function(){this.savedSelection=o.call(this)},restoreSelection:function(){n.call(this,this.savedSelection)},showAnchorForm:function(t){this.toolbarActions.style.display="none",this.saveSelection(),this.anchorForm.style.display="block",this.setToolbarPosition(),this.keepToolbarAlive=!0,this.anchorInput.focus(),this.anchorInput.value=t||""},bindAnchorForm:function(){var t=this.anchorForm.querySelector("a.medium-editor-toobar-anchor-close"),e=this.anchorForm.querySelector("a.medium-editor-toobar-anchor-save"),o=this;return this.on(this.anchorForm,"click",(function(t){t.stopPropagation(),o.keepToolbarAlive=!0})),this.on(this.anchorInput,"keyup",(function(t){var e,i=null;13===t.keyCode&&(t.preventDefault(),e=o.options.anchorTarget&&o.anchorTarget.checked?"_blank":"_self",o.options.anchorButton&&o.anchorButton.checked&&(i=o.options.anchorButtonClass),o.createLink(this,e,i))})),this.on(e,"click",(function(t){var e,i=null;t.preventDefault(),e=o.options.anchorTarget&&o.anchorTarget.checked?"_blank":"_self",o.options.anchorButton&&o.anchorButton.checked&&(i=o.options.anchorButtonClass),o.createLink(o.anchorInput,e,i)}),!0),this.on(this.anchorInput,"click",(function(t){t.stopPropagation(),o.keepToolbarAlive=!0})),this.on(this.options.ownerDocument.body,"click",(function(t){t.target===o.anchorForm||i(o.anchorForm,t.target)||i(o.toolbarActions,t.target)||(o.keepToolbarAlive=!1,o.checkSelection())}),!0),this.on(this.options.ownerDocument.body,"focus",(function(t){t.target===o.anchorForm||i(o.anchorForm,t.target)||i(o.toolbarActions,t.target)||(o.keepToolbarAlive=!1,o.checkSelection())}),!0),this.on(t,"click",(function(t){t.preventDefault(),o.showToolbarActions(),n.call(o,o.savedSelection)})),this},hideAnchorPreview:function(){this.anchorPreview.classList.remove("medium-editor-anchor-preview-active")},showAnchorPreview:function(t){if(this.anchorPreview.classList.contains("medium-editor-anchor-preview-active")||t.getAttribute("data-disable-preview"))return!0;var e,i,o,n=this,r=t.getBoundingClientRect(),a=(r.left+r.right)/2;return n.anchorPreview.querySelector("i").textContent=t.href,e=n.anchorPreview.offsetWidth/2,i=n.options.diffLeft-e,clearTimeout(o),o=setTimeout((function(){n.anchorPreview&&!n.anchorPreview.classList.contains("medium-editor-anchor-preview-active")&&n.anchorPreview.classList.add("medium-editor-anchor-preview-active")}),100),n.observeAnchorPreview(t),n.anchorPreview.classList.add("medium-toolbar-arrow-over"),n.anchorPreview.classList.remove("medium-toolbar-arrow-under"),n.anchorPreview.style.top=Math.round(40+r.bottom-n.options.diffTop+this.options.contentWindow.pageYOffset-n.anchorPreview.offsetHeight)+"px",a<e?n.anchorPreview.style.left=i+e+"px":this.options.contentWindow.innerWidth-a<e?n.anchorPreview.style.left=this.options.contentWindow.innerWidth+i-e+"px":n.anchorPreview.style.left=i+a+"px",this},observeAnchorPreview:function(t){var e=this,i=(new Date).getTime(),o=!0,n=function(){i=(new Date).getTime(),o=!0},r=function(t){t.relatedTarget&&/anchor-preview/.test(t.relatedTarget.className)||(o=!1)},a=setInterval((function(){if(o)return!0;(new Date).getTime()-i>e.options.anchorPreviewHideDelay&&(e.hideAnchorPreview(),clearInterval(a),e.off(e.anchorPreview,"mouseover",n),e.off(e.anchorPreview,"mouseout",r),e.off(t,"mouseover",n),e.off(t,"mouseout",r))}),200);this.on(e.anchorPreview,"mouseover",n),this.on(e.anchorPreview,"mouseout",r),this.on(t,"mouseover",n),this.on(t,"mouseout",r)},createAnchorPreview:function(){var t=this,e=this.options.ownerDocument.createElement("div");return e.id="medium-editor-anchor-preview-"+this.id,e.className="medium-editor-anchor-preview",e.innerHTML=this.anchorPreviewTemplate(),this.options.elementsContainer.appendChild(e),this.on(e,"click",(function(){t.anchorPreviewClickHandler()})),e},anchorPreviewTemplate:function(){return'<div class="medium-editor-toolbar-anchor-preview" id="medium-editor-toolbar-anchor-preview">    <i class="medium-editor-toolbar-anchor-preview-inner"></i></div>'},anchorPreviewClickHandler:function(t){if(this.activeAnchor){var e=this,i=this.options.ownerDocument.createRange(),o=this.options.contentWindow.getSelection();i.selectNodeContents(e.activeAnchor),o.removeAllRanges(),o.addRange(i),setTimeout((function(){e.activeAnchor&&e.showAnchorForm(e.activeAnchor.href),e.keepToolbarAlive=!1}),100+e.options.delay)}this.hideAnchorPreview()},editorAnchorObserver:function(t){var e=this,i=!0,o=function(){i=!1,e.off(e.activeAnchor,"mouseout",o)};if(t.target&&"a"===t.target.tagName.toLowerCase()){if(!/href=["']\S+["']/.test(t.target.outerHTML)||/href=["']#\S+["']/.test(t.target.outerHTML))return!0;if(this.toolbar.classList.contains("medium-editor-toolbar-active"))return!0;this.activeAnchor=t.target,this.on(this.activeAnchor,"mouseout",o),setTimeout((function(){i&&e.showAnchorPreview(t.target)}),e.options.delay)}},bindAnchorPreview:function(t){var e,i=this;for(this.editorAnchorObserverWrapper=function(t){i.editorAnchorObserver(t)},e=0;e<this.elements.length;e+=1)this.on(this.elements[e],"mouseover",this.editorAnchorObserverWrapper);return this},checkLinkFormat:function(t){return(/^(https?|ftps?|rtmpt?):\/\/|mailto:/.test(t)?"":"http://")+t},setTargetBlank:function(t){var e;if("a"===(t=t||r.call(this)).tagName.toLowerCase())t.target="_blank";else for(t=t.getElementsByTagName("a"),e=0;e<t.length;e+=1)t[e].target="_blank"},setButtonClass:function(t){var e,i,o=r.call(this),n=t.split(" ");if("a"===o.tagName.toLowerCase())for(i=0;i<n.length;i+=1)o.classList.add(n[i]);else for(o=o.getElementsByTagName("a"),e=0;e<o.length;e+=1)for(i=0;i<n.length;i+=1)o[e].classList.add(n[i])},createLink:function(t,e,i){var o,r;if(0!==t.value.trim().length){if(n.call(this,this.savedSelection),this.options.checkLinkFormat&&(t.value=this.checkLinkFormat(t.value)),this.options.ownerDocument.execCommand("createLink",!1,t.value),(this.options.targetBlank||"_blank"===e)&&this.setTargetBlank(),i&&this.setButtonClass(i),this.options.targetBlank||"_blank"===e||i)for((r=this.options.ownerDocument.createEvent("HTMLEvents")).initEvent("input",!0,!0,this.options.contentWindow),o=0;o<this.elements.length;o+=1)this.elements[o].dispatchEvent(r);this.checkSelection(),this.showToolbarActions(),t.value=""}else this.hideToolbarActions()},bindWindowActions:function(){var t,e=this;return this.windowResizeHandler=function(){clearTimeout(t),t=setTimeout((function(){e.toolbar&&e.toolbar.classList.contains("medium-editor-toolbar-active")&&e.setToolbarPosition()}),100)},this.on(this.options.contentWindow,"resize",this.windowResizeHandler),this},activate:function(){this.isActive||this.setup()},deactivate:function(){var t;if(this.isActive){for(this.isActive=!1,void 0!==this.toolbar&&(this.options.elementsContainer.removeChild(this.anchorPreview),this.options.elementsContainer.removeChild(this.toolbar),delete this.toolbar,delete this.anchorPreview),t=0;t<this.elements.length;t+=1)this.elements[t].removeAttribute("contentEditable"),this.elements[t].removeAttribute("data-medium-element");this.removeAllEvents()}},htmlEntities:function(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},bindPaste:function(){var t,e=this;for(this.pasteWrapper=function(t){var i,o,n="";if(this.classList.remove("medium-editor-placeholder"),!e.options.forcePlainText&&!e.options.cleanPastedHTML)return this;if(t.clipboardData&&t.clipboardData.getData&&!t.defaultPrevented){if(t.preventDefault(),e.options.cleanPastedHTML&&t.clipboardData.getData("text/html"))return e.cleanPaste(t.clipboardData.getData("text/html"));if(e.options.disableReturn||this.getAttribute("data-disable-return"))n=e.htmlEntities(t.clipboardData.getData("text/plain")),e.options.ownerDocument.execCommand("insertHTML",!1,n);else{for(i=t.clipboardData.getData("text/plain").split(/[\r\n]/g),o=0;o<i.length;o+=1)""!==i[o]&&(navigator.userAgent.match(/firefox/i)&&0===o?n+=e.htmlEntities(i[o]):n+="<p>"+e.htmlEntities(i[o])+"</p>");e.options.ownerDocument.execCommand("insertHTML",!1,n)}}},t=0;t<this.elements.length;t+=1)this.on(this.elements[t],"paste",this.pasteWrapper);return this},setPlaceholders:function(){var t,e=function(t){t.querySelector("img")||t.querySelector("blockquote")||""!==t.textContent.replace(/^\s+|\s+$/g,"")||t.classList.add("medium-editor-placeholder")},i=function(t){this.classList.remove("medium-editor-placeholder"),"keypress"!==t.type&&e(this)};for(t=0;t<this.elements.length;t+=1)e(this.elements[t]),this.on(this.elements[t],"blur",i),this.on(this.elements[t],"keypress",i);return this},cleanPaste:function(t){var e,i,o,n=this.getSelectionElement(),r=/<p|<br|<div/.test(t),a=[[new RegExp(/<[^>]*docs-internal-guid[^>]*>/gi),""],[new RegExp(/<\/b>(<br[^>]*>)?$/gi),""],[new RegExp(/<span class="Apple-converted-space">\s+<\/span>/g)," "],[new RegExp(/<br class="Apple-interchange-newline">/g),"<br>"],[new RegExp(/<span[^>]*(font-style:italic;font-weight:bold|font-weight:bold;font-style:italic)[^>]*>/gi),'<span class="replace-with italic bold">'],[new RegExp(/<span[^>]*font-style:italic[^>]*>/gi),'<span class="replace-with italic">'],[new RegExp(/<span[^>]*font-weight:bold[^>]*>/gi),'<span class="replace-with bold">'],[new RegExp(/&lt;(\/?)(i|b|a)&gt;/gi),"<$1$2>"],[new RegExp(/&lt;a\s+href=(&quot;|&rdquo;|&ldquo;|“|”)([^&]+)(&quot;|&rdquo;|&ldquo;|“|”)&gt;/gi),'<a href="$2">']];for(e=0;e<a.length;e+=1)t=t.replace(a[e][0],a[e][1]);if(r)for(i=t.split("<br><br>"),this.pasteHTML("<p>"+i.join("</p><p>")+"</p>"),this.options.ownerDocument.execCommand("insertText",!1,"\n"),i=n.querySelectorAll("a,p,div,br"),e=0;e<i.length;e+=1)switch((o=i[e]).tagName.toLowerCase()){case"a":this.options.targetBlank&&this.setTargetBlank(o);break;case"p":case"div":this.filterCommonBlocks(o);break;case"br":this.filterLineBreak(o)}else this.pasteHTML(t)},pasteHTML:function(t){var e,i,o,n,r=this.options.ownerDocument.createDocumentFragment();for(r.appendChild(this.options.ownerDocument.createElement("body")),(n=r.querySelector("body")).innerHTML=t,this.cleanupSpans(n),e=n.querySelectorAll("*"),o=0;o<e.length;o+=1)(i=e[o]).removeAttribute("class"),i.removeAttribute("style"),i.removeAttribute("dir"),"meta"===i.tagName.toLowerCase()&&i.parentNode.removeChild(i);this.options.ownerDocument.execCommand("insertHTML",!1,n.innerHTML.replace(/&nbsp;/g," "))},isCommonBlock:function(t){return t&&("p"===t.tagName.toLowerCase()||"div"===t.tagName.toLowerCase())},filterCommonBlocks:function(t){/^\s*$/.test(t.innerText)&&t.parentNode.removeChild(t)},filterLineBreak:function(t){this.isCommonBlock(t.previousElementSibling)?t.parentNode.removeChild(t):!this.isCommonBlock(t.parentNode)||t.parentNode.firstChild!==t&&t.parentNode.lastChild!==t?1===t.parentNode.childElementCount&&this.removeWithParent(t):t.parentNode.removeChild(t)},removeWithParent:function(t){t&&t.parentNode&&(t.parentNode.parentNode&&1===t.parentNode.childElementCount?t.parentNode.parentNode.removeChild(t.parentNode):t.parentNode.removeChild(t.parentNode))},cleanupSpans:function(t){var e,i,o,n=t.querySelectorAll(".replace-with");for(e=0;e<n.length;e+=1)i=n[e],o=this.options.ownerDocument.createElement(i.classList.contains("bold")?"b":"i"),i.classList.contains("bold")&&i.classList.contains("italic")?o.innerHTML="<i>"+i.innerHTML+"</i>":o.innerHTML=i.innerHTML,i.parentNode.replaceChild(o,i);for(n=t.querySelectorAll("span"),e=0;e<n.length;e+=1)i=n[e],/^\s*$/.test()?i.parentNode.removeChild(i):i.parentNode.replaceChild(this.options.ownerDocument.createTextNode(i.innerText),i)}}}(window,document);