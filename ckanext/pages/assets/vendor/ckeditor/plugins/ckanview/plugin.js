/**
 * @license Copyright (c) 2003-2014, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or http://ckeditor.com/license
 */
CKEDITOR.plugins.add("ckanview",{requires:"dialog,fakeobjects",lang:"en-gb",icons:"ckanview",hidpi:!0,onLoad:function(){CKEDITOR.addCss("img.ckan-view-fake{background-image: url(http://placehold.it/80x80&text=CKAN+view);background-position: center center;background-repeat: no-repeat;border: 2px solid #a9a9a9;display: block;width: 80px;height: 80px;}")},init:function(e){var a="ckanview",t=e.lang.ckanview,i="iframe[align,longdesc,frameborder,height,name,scrolling,src,title,width,data-ckan-view-embed]";e.plugins.dialogadvtab&&(i+=";iframe"+e.plugins.dialogadvtab.allowedContent({id:1,classes:1,styles:1})),CKEDITOR.dialog.add(a,this.path+"dialogs/ckanview.js"),e.addCommand(a,new CKEDITOR.dialogCommand(a,{allowedContent:i,requiredContent:"iframe"})),e.ui.addButton&&e.ui.addButton("ckanview",{label:t.toolbar,command:a,toolbar:"insert,80"}),e.on("doubleclick",(function(e){var a=e.data.element;a.is("img")&&"true"==a.data("ckan-view-embed")&&(e.data.dialog="ckanview")})),e.addMenuItems&&e.addMenuItems({ckanview:{label:t.title,command:"ckanview",group:"image"}}),e.contextMenu&&e.contextMenu.addListener((function(e,a){if(e&&e.is("img")&&"true"==e.data("ckan-view-embed"))return{iframe:CKEDITOR.TRISTATE_OFF}}))},afterInit:function(e){var a=e.dataProcessor,t=a&&a.dataFilter;t&&t.addRules({elements:{iframe:function(a){var t=e.createFakeParserElement(a,"ckan-view-fake","iframe",!0),i=a.attributes.width||"80",n=a.attributes.height||"80";return"%"===i.charAt(i.length-1)&&(i="960"),"%"===n.charAt(n.length-1)&&(n="400"),t.attributes["data-ckan-view-embed"]="true",t.attributes.src="http://placehold.it/"+i+"x"+n+"&text=CKAN+View",t}}})}});